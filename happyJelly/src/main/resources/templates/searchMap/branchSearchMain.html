<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Jelly - 지점 찾기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8f4cf2011b98623f426842d7be946f0f"></script>
	<script>
	var map;

	$(document).ready(function() {
	    loadBranches();
	    initMap();
	});

	function loadBranches() {
	    $.ajax({
	        url: "/api/branches",
	        method: "GET",
	        success: function(data) {
	            displayBranches(data);
	            addMarkersToMap(data);
	        },
	        error: function(xhr, status, error) {
	            console.error("Error loading branches:", error);
	        }
	    });
	}

	function initMap() {
	    var container = document.getElementById('map');
	    var options = {
	        center: new kakao.maps.LatLng(37.566826, 126.9786567),
	        level: 8
	    };
	    map = new kakao.maps.Map(container, options);
	}

	// 지도에 마커 추가
	function addMarkersToMap(branches) {
	    branches.forEach(function(branch) {
	        var markerPosition = new kakao.maps.LatLng(branch.latitude, branch.longitude);
	        var marker = new kakao.maps.Marker({
	            position: markerPosition
	        });
	        marker.setMap(map);

	        var infowindow = new kakao.maps.InfoWindow({
	            content: '<div style="padding:5px;">' + branch.branchesName + '</div>'
	        });

	        kakao.maps.event.addListener(marker, 'click', function() {
	            infowindow.open(map, marker);
	        });
	    });
	}
	
	
	
	
	// 지점 목록 표시
	function displayBranches(branches) {
	    console.log("Displaying branches:", branches);
	    var branchList = $("#branchList");
	    branchList.empty();
	    if (branches.length === 0) {
	        console.log("No branches to display");
	        branchList.html('<p class="text-center py-4">표시할 지점이 없습니다.</p>');
	        return;
	    }
	    branches.forEach(function(branch) {
	        console.log("Processing branch:", branch);
	        var branchElement = $(`
	            <div class="p-4 border-b hover:bg-gray-100 cursor-pointer">
	                <h3 class="font-bold text-happy-black">${branch.branchesName || branch.name}</h3>
	                <p class="text-sm text-gray-600">${branch.address}</p>
	                <p class="text-sm text-gray-600">${branch.phone}</p>
	            </div>
	        `);
	        branchList.append(branchElement);
	    });
	    console.log("Branches display completed");
	}
	
	        // 검색 기능
	        $("#searchButton").click(function() {
	            var searchTerm = $("#searchInput").val();
	     
	        });
	
	        function loadKakaoMapsScript() {
	        	  var script = document.createElement('script');
	        	  script.src = '//dapi.kakao.com/v2/maps/sdk.js?appkey=8f4cf2011b98623f426842d7be946f0f';
	        	  script.async = true;
	        	  document.head.appendChild(script);
	        	  return new Promise((resolve) => {
	        	    script.onload = resolve;
	        	  });
	        	}
	
	        	loadKakaoMapsScript().then(() => {
	        	  // Kakao 지도 초기화 코드
	        	});
	    </script>
    <style>
        .store-list {
            height: calc(100vh - 250px);
            overflow-y: auto;
        }
        #map {
            height: calc(100vh - 100px);
        }
        .bg-happy-yellow {
            background-color: #FFD700;
        }
        .text-happy-black {
            color: #333333;
        }
        .border-happy-yellow {
            border-color: #FFD700;
        }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-happy-yellow p-4 shadow-md">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold text-happy-black">Happy Jelly</h1>
        </div>
    </nav>
            <!-- 왼쪽 섹션: 검색 및 지점 리스트 -->
    <div class="container mx-auto p-4">
        <h2 class="text-2xl font-bold mb-6 text-happy-black">지점 찾기</h2>
        <div class="flex flex-col md:flex-row gap-4">
            <div class="md:w-1/3">
                <div class="mb-4">
                    <input type="text" id="searchInput" placeholder="지역명 또는 우편번호 입력" class="w-full p-2 border border-happy-yellow rounded focus:outline-none focus:ring-2 focus:ring-happy-yellow">
                </div>
                <button id="searchButton" class="w-full bg-happy-yellow text-happy-black font-bold p-2 rounded mb-4 hover:bg-yellow-400 transition duration-300">검색</button>
                <div id="branchList" class="store-list bg-white rounded shadow">
                    <!-- 지점 목록이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 오른쪽 섹션: 지도 -->
            <div class="md:w-2/3">
                <div id="map" class="rounded shadow-lg"></div>
            </div>
        </div>
    </div>

<!--     <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8f4cf2011b98623f426842d7be946f0f"> -->

</body>
</html>